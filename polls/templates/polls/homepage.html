<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BioPoll</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">

    <style>
        /* This makes layouts more predictable */
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #000000;
            font-family: 'Lilita One', sans-serif;
            color: #ffffff;
            display: flex;
            flex-direction: column; /* This stacks the intro and poll box vertically */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        
        /* New styles for the text outside the box */
        .intro-section {
            text-align: center;
            margin-bottom: 2em; /* Adds space between the intro and the poll box */
            max-width: 650px; /* Keeps the text from getting too wide */
            padding: 0 1em;
        }

        .main-heading {
            font-size: 3.5em; /* Makes "BioPoll" big */
            margin-bottom: 0.25em;
            line-height: 1;
        }

        .poll-container {
            max-width: 1200px;
            width: 100%;
            padding: 2em;
            border: 7px solid #f08c00;
            border-radius: 25px;
        }

        .choice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5em;
            border-radius: 5px;
            font-size: 1.1em;
        }
        
        .choice-item:hover {
            background-color: #333;
        }

        .votes {
            background-color: #444;
            padding: 0.2em 0.6em;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <div class="intro-section">
        <h1 class="main-heading">BioPoll</h1>
        <p>Hey, everyone. I ask you to vote in this poll very politely.</p>
        <p>This is a poll for my Instagram bio, as I can't decide which one I should put there.</p>
        <p>To give you some context about me, I am a very extroverted and candid person, so go ham!</p>
        <p>SO ABOUT VOTING, there is a 5 second delay after you select an option, so please be patient.</p>
        <p>Please CLICK ONCE EVERY 5 SECONDS</p>
    </div>

    <div class="poll-container">
        <h1>{{ question.question_text }}</h1>
        <p>Select an option below to cast your vote.</p>
        <p id="error-message" style="color: red; font-weight: bold;"></p>
        <form id="poll-form">
            {% csrf_token %}
            {% for choice in question.choice_set.all %}
                <div class="choice-item">
                    <label>
                        <input type="radio" name="choice" id="choice{{ forloop.counter }}" value="{{ choice.id }}">
                        {{ choice.choice_text }}
                    </label>
                    <strong class="votes">
                        Votes: <span id="votes-{{ choice.id }}">{{ choice.votes }}</span>
                    </strong>
                </div>
            {% endfor %}
        </form>
    </div>

    <script>
        const pollForm = document.getElementById('poll-form');
        const radioButtons = pollForm.querySelectorAll('input[name="choice"]');
        const csrfToken = pollForm.querySelector('[name=csrfmiddlewaretoken]').value;
        const errorMessage = document.getElementById('error-message');

        radioButtons.forEach(button => {
            button.addEventListener('change', event => {
                const selectedChoiceId = event.target.value;
                errorMessage.textContent = '';

                const formData = new FormData();
                formData.append('choice', selectedChoiceId);

                fetch("{% url 'vote' question.id %}", {
                    method: 'POST',
                    headers: { 'X-CSRFToken': csrfToken },
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        for (const choiceId in data.votes) {
                            const voteSpan = document.getElementById('votes-' + choiceId);
                            if (voteSpan) {
                                voteSpan.textContent = data.votes[choiceId];
                            }
                        }
                    } else {
                        errorMessage.textContent = data.error_message;
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    </script>
</body>
</html>